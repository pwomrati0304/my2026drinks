<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>à¹‚à¸¡åˆåœ¨å–é£²æ–™ 2026</title>
    <style>
        :root {
            --primary: #87CEEB; /* æ·ºè—è‰² */
            --primary-dark: #4682B4;
            --bg-color: #F0F8FF;
            --text-color: #333;
            --card-bg: #ffffff;
            --accent: #FF8C00; /* é‡é»è‰²ï¼šæ©˜è‰² */
            --danger: #ff6b6b;
        }

        body {
            font-family: "Microsoft JhengHei", Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            color: var(--primary-dark);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            margin: 10px 0 20px 0;
            font-size: 1.6rem;
        }

        /* --- å„€è¡¨æ¿å€åŸŸ (Dashboard) --- */
        .dashboard {
            background: var(--card-bg);
            width: 100%;
            max-width: 800px;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(135, 206, 235, 0.25);
            border: 1px solid #e0efff;
        }

        .dashboard-header {
            font-size: 1.1rem;
            color: var(--primary-dark);
            font-weight: bold;
            margin-bottom: 15px;
            border-bottom: 2px solid var(--bg-color);
            padding-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .stat-card {
            background: var(--bg-color);
            padding: 12px 8px;
            border-radius: 12px;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 80px;
        }

        /* è®“æœ€æ„›åº—å®¶/å“é …åœ¨æ‰‹æ©Ÿä¸Šä½”å¯¬ä¸€é» */
        .stat-card.wide {
            grid-column: span 1; 
        }

        .stat-label {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.25rem;
            font-weight: 800;
            color: var(--primary-dark);
        }

        .stat-value.highlight {
            color: var(--accent);
        }

        .stat-sub {
            font-size: 0.75rem;
            color: #888;
            margin-top: 4px;
        }

       /* RWD: æ‰‹æ©Ÿç‰ˆèª¿æ•´ */
        @media (max-width: 600px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr); /* ç¶­æŒå…©æ¬„ */
            }
            

        /* --- æŒ‰éˆ•èˆ‡å°èˆª --- */
        .controls-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            width: 100%;
            max-width: 800px;
        }

        .nav-panel {
            background: white;
            padding: 5px 10px;
            border-radius: 50px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: 0.2s;
            white-space: nowrap;
        }
        
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        
        .btn-secondary { background: #e0e0e0; color: #555; font-size: 0.85rem; }
        .btn-secondary:hover { background: #d0d0d0; }

        #currentMonthDisplay {
            font-weight: bold;
            color: var(--primary-dark);
            min-width: 110px;
            text-align: center;
        }

        /* --- æ—¥æ›†æœ¬é«” --- */
        .calendar-container {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            max-width: 800px;
            width: 100%;
            margin-bottom: 40px;
        }

        .day-header {
            text-align: center;
            font-weight: bold;
            color: #888;
            font-size: 0.9rem;
            padding-bottom: 5px;
        }

        .day-cell {
            background: white;
            min-height: 100px;
            border-radius: 12px;
            padding: 8px;
            cursor: pointer;
            transition: transform 0.2s;
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            gap: 4px;
            position: relative;
        }

        .day-cell:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
            box-shadow: 0 4px 10px rgba(135, 206, 235, 0.3);
        }

        .day-number {
            font-weight: bold;
            color: var(--primary-dark);
            margin-bottom: 2px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .daily-cost {
            font-size: 0.75rem;
            color: #999;
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 6px;
        }

        .drink-dot {
            background-color: var(--bg-color);
            border-left: 3px solid var(--primary);
            padding: 4px 6px;
            font-size: 0.75rem;
            border-radius: 0 4px 4px 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.3;
        }

        .empty-slot { visibility: hidden; }

        /* --- Modal å½ˆå‡ºè¦–çª— --- */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center; align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            width: 90%;
            max-width: 450px;
            max-height: 90vh;
            overflow-y: auto;
            border-top: 6px solid var(--primary);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .modal-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px;
        }
        
        .close-btn { background: none; border: none; font-size: 1.8rem; color: #999; cursor: pointer; padding: 0 5px; }

        /* è¡¨å–®å…ƒä»¶ */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 6px; font-weight: bold; color: #555; font-size: 0.95rem; }
        input[type="text"], input[type="number"] {
            width: 100%; padding: 12px; border: 1px solid #ccc;
            border-radius: 8px; box-sizing: border-box; font-size: 1rem;
        }
        input:focus { border-color: var(--primary); outline: none; }

        .grid-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        /* é‡å°ç”œåº¦å¦‚æœæœ‰7å€‹é¸é …ï¼Œæœ€å¾Œä¸€è¡Œç½®ä¸­æˆ–å¡«æ»¿ */
        .sugar-grid {
             grid-template-columns: repeat(3, 1fr);
        }

        .option-label {
            text-align: center; padding: 10px; border: 1px solid #ddd;
            border-radius: 8px; cursor: pointer; font-size: 0.9rem; color: #666;
            transition: 0.2s; display: block;
        }
        
        input[type="radio"] { display: none; }
        input[type="radio"]:checked + .option-label {
            background-color: var(--primary); color: white; border-color: var(--primary);
            box-shadow: 0 2px 5px rgba(135, 206, 235, 0.4);
        }

        /* å·²å„²å­˜åˆ—è¡¨ */
        .saved-item {
            background: #f8fbff; border: 1px solid #eef; padding: 12px;
            margin-bottom: 10px; border-radius: 8px; display: flex;
            justify-content: space-between; align-items: center;
        }
        .saved-info { line-height: 1.4; }
        .saved-info strong { color: var(--primary-dark); font-size: 1.05rem; }
        .saved-price { font-weight: bold; color: var(--accent); margin-left: 10px; font-size: 1.1rem; }
        .del-btn { background: var(--danger); color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85rem; }
        
        .submit-btn {
            width: 100%; background: var(--primary-dark); color: white;
            padding: 14px; border: none; border-radius: 10px; font-size: 1.1rem;
            cursor: pointer; margin-top: 10px; font-weight: bold;
        }
        .submit-btn:disabled { background: #ccc; cursor: not-allowed; }
        .limit-msg { color: var(--danger); text-align: center; margin-top: 10px; font-weight: bold; display: none; }

    </style>
</head>
<body>

    <h1>ğŸ˜¼ à¹‚à¸¡à¹ˆåˆåœ¨å–é£²æ–™</h1>

    <div class="dashboard">
        <div class="dashboard-header">
            <span>ğŸ“Š <span id="statsYearTitle">2026</span> å¹´åº¦æˆ°ç¸¾</span>
        </div>
        <div class="stats-grid">
            <div class="stat-card">
                <span class="stat-label">å¹´åº¦ç¸½èŠ±è²»</span>
                <span class="stat-value highlight" id="statYearCost">$0</span>
            </div>
            <div class="stat-card">
                <span class="stat-label">å¹´åº¦ç¸½æ¯æ•¸</span>
                <span class="stat-value" id="statYearCups">0</span>
            </div>
            <div class="stat-card">
                <span class="stat-label">å¹³å‡å–®åƒ¹</span>
                <span class="stat-value" id="statAvgPrice">$0</span>
            </div>
            <div class="stat-card wide">
                <span class="stat-label">æœ€æ„›åº—å®¶</span>
                <span class="stat-value" id="statFavStore">-</span>
                <span class="stat-sub" id="statFavStoreCount"></span>
            </div>
            <div class="stat-card wide">
                <span class="stat-label">æœ€æ„›å“é …</span>
                <span class="stat-value" id="statFavItem">-</span>
                <span class="stat-sub" id="statFavItemCount"></span>
            </div>
             <div class="stat-card">
                <span class="stat-label">æœ¬æœˆèŠ±è²»</span>
                <span class="stat-value" id="statMonthCost" style="color: #666;">$0</span>
            </div>
        </div>
    </div>

    <div class="controls-container">
        <div class="nav-panel">
            <button class="btn btn-primary" onclick="changeMonth(-1)">â®</button>
            <div id="currentMonthDisplay">2026 å¹´ 1 æœˆ</div>
            <button class="btn btn-primary" onclick="changeMonth(1)">â¯</button>
        </div>

        <div style="display:flex; gap:10px;">
            <button class="btn btn-secondary" onclick="exportData()">â¬‡ï¸ å‚™ä»½</button>
            <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">â¬†ï¸ é‚„åŸ</button>
            <input type="file" id="importFile" style="display:none" accept=".json" onchange="importData(this)">
        </div>
    </div>

    <div class="calendar-container">
        <div class="day-header">é€±æ—¥</div>
        <div class="day-header">é€±ä¸€</div>
        <div class="day-header">é€±äºŒ</div>
        <div class="day-header">é€±ä¸‰</div>
        <div class="day-header">é€±å››</div>
        <div class="day-header">é€±äº”</div>
        <div class="day-header">é€±å…­</div>
        <div id="calendarGrid" style="display: contents;"></div>
    </div>

    <div id="drinkModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalDateTitle" style="margin:0;">æ–°å¢ç´€éŒ„</h3>
                <button class="close-btn" onclick="closeModal()">Ã—</button>
            </div>

            <div id="savedDrinksList"></div>
            
            <hr style="margin: 15px 0; border: 0; border-top: 1px dashed #eee;">

            <div id="addDrinkForm">
                <div class="form-group">
                    <label>åº—å</label>
                    <input type="text" id="storeName" placeholder="ä¾‹å¦‚ï¼š50åµ">
                </div>
                <div class="form-group">
                    <label>å“é …</label>
                    <input type="text" id="itemName" placeholder="ä¾‹å¦‚ï¼šå››å­£æ˜¥çæ³¢æ¤°">
                </div>
                <div class="form-group">
                    <label>åƒ¹æ ¼</label>
                    <input type="number" id="drinkPrice" placeholder="ä¾‹å¦‚ï¼š55" inputmode="numeric">
                </div>

                <div class="form-group">
                    <label>å†°å¡Š</label>
                    <div class="grid-options">
                        <label><input type="radio" name="ice" value="æ­£å¸¸" checked><span class="option-label">æ­£å¸¸</span></label>
                        <label><input type="radio" name="ice" value="å°‘å†°"><span class="option-label">å°‘å†°</span></label>
                        <label><input type="radio" name="ice" value="å¾®å†°"><span class="option-label">å¾®å†°</span></label>
                        <label><input type="radio" name="ice" value="å»å†°"><span class="option-label">å»å†°</span></label>
                        <label><input type="radio" name="ice" value="å¸¸æº«"><span class="option-label">å¸¸æº«</span></label>
                        <label><input type="radio" name="ice" value="æº«"><span class="option-label">æº«</span></label>
                    </div>
                </div>

                <div class="form-group">
                    <label>ç”œåº¦</label>
                    <div class="grid-options sugar-grid">
                        <label><input type="radio" name="sugar" value="å…¨ç³–" checked><span class="option-label">å…¨ç³–</span></label>
                        <label><input type="radio" name="sugar" value="å°‘ç³–"><span class="option-label">å°‘ç³–</span></label>
                        <label><input type="radio" name="sugar" value="åŠç³–"><span class="option-label">åŠç³–</span></label>
                        <label><input type="radio" name="sugar" value="å¾®ç³–"><span class="option-label">å¾®ç³–</span></label>
                        <label><input type="radio" name="sugar" value="äºŒåˆ†"><span class="option-label">äºŒåˆ†</span></label>
                        <label><input type="radio" name="sugar" value="ä¸€åˆ†"><span class="option-label">ä¸€åˆ†</span></label>
                        <label><input type="radio" name="sugar" value="ç„¡ç³–"><span class="option-label">ç„¡ç³–</span></label>
                    </div>
                </div>

                <button class="submit-btn" id="saveBtn" onclick="saveDrink()">æ–°å¢é£²æ–™</button>
                <div id="limitMsg" class="limit-msg">æœ¬æ—¥å·²é” 2 æ¯ä¸Šé™ï¼Œæ˜å¤©å†å–ï¼</div>
            </div>
        </div>
    </div>

    <script>
        let currentYear = 2026;
        let currentMonth = 0; 
        let selectedDateKey = "";
        const storageKey = "bubble_tea_tracker_2026";
        
        function getData() {
            const data = localStorage.getItem(storageKey);
            return data ? JSON.parse(data) : {};
        }

        function saveData(data) {
            localStorage.setItem(storageKey, JSON.stringify(data));
            renderCalendar();
        }

        function init() {
            renderCalendar();
        }

        // --- æ ¸å¿ƒé‹ç®—ï¼šè¨ˆç®—æ‰€æœ‰çµ±è¨ˆæ•¸æ“š ---
        function calculateStats(allData) {
            let monthCost = 0;
            let yearCost = 0;
            let yearCups = 0;
            let storeCounts = {};
            let itemCounts = {};

            const monthPrefix = `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}`;
            const yearPrefix = `${currentYear}-`;

            Object.keys(allData).forEach(key => {
                // åªè¨ˆç®—ç•¶å‰å¹´ä»½
                if (key.startsWith(yearPrefix)) {
                    allData[key].forEach(drink => {
                        const price = parseInt(drink.price) || 0;
                        yearCost += price;
                        yearCups += 1;

                        // çµ±è¨ˆåº—å®¶é »ç‡
                        const s = drink.store || "æœªçŸ¥";
                        storeCounts[s] = (storeCounts[s] || 0) + 1;

                        // çµ±è¨ˆå“é …é »ç‡
                        const i = drink.item || "æœªçŸ¥";
                        itemCounts[i] = (itemCounts[i] || 0) + 1;

                        // çµ±è¨ˆæœ¬æœˆ
                        if (key.startsWith(monthPrefix)) {
                            monthCost += price;
                        }
                    });
                }
            });

            // å°‹æ‰¾å‡ºç¾æ¬¡æ•¸æœ€å¤šçš„å‡½æ•¸
            const getTop = (obj) => {
                let maxKey = "-";
                let maxVal = 0;
                for (const [key, val] of Object.entries(obj)) {
                    if (val > maxVal) {
                        maxVal = val;
                        maxKey = key;
                    }
                }
                return { key: maxKey, count: maxVal };
            };

            const topStore = getTop(storeCounts);
            const topItem = getTop(itemCounts);
            const avgPrice = yearCups > 0 ? Math.round(yearCost / yearCups) : 0;

            // æ›´æ–° UI é¡¯ç¤º
            document.getElementById('statsYearTitle').innerText = currentYear;
            document.getElementById('statMonthCost').innerText = `$${monthCost}`;
            document.getElementById('statYearCost').innerText = `$${yearCost}`;
            document.getElementById('statYearCups').innerText = `${yearCups} æ¯`;
            document.getElementById('statAvgPrice').innerText = `$${avgPrice}`;
            
            document.getElementById('statFavStore').innerText = topStore.count > 0 ? topStore.key : "-";
            document.getElementById('statFavStoreCount').innerText = topStore.count > 0 ? `(å–äº† ${topStore.count} æ¬¡)` : "";
            
            document.getElementById('statFavItem').innerText = topItem.count > 0 ? topItem.key : "-";
            document.getElementById('statFavItemCount').innerText = topItem.count > 0 ? `(é»äº† ${topItem.count} æ¬¡)` : "";
        }

        // --- æ¸²æŸ“ç•«é¢ ---
        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const display = document.getElementById('currentMonthDisplay');
            
            grid.innerHTML = "";
            display.innerText = `${currentYear} å¹´ ${currentMonth + 1} æœˆ`;

            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const allData = getData();

            // æ¯æ¬¡æ¸²æŸ“æ—¥æ›†æ™‚ï¼Œé †ä¾¿æ›´æ–°ä¸Šæ–¹çš„å„€è¡¨æ¿æ•¸æ“š
            calculateStats(allData);

            // å¡«è£œç©ºç™½
            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = "day-cell empty-slot";
                grid.appendChild(emptyCell);
            }

            // å¡«è£œæ—¥æœŸ
            for (let day = 1; day <= daysInMonth; day++) {
                const cell = document.createElement('div');
                cell.className = "day-cell";
                
                const monthStr = (currentMonth + 1).toString().padStart(2, '0');
                const dayStr = day.toString().padStart(2, '0');
                const dateKey = `${currentYear}-${monthStr}-${dayStr}`;

                let dailyTotal = 0;
                let drinksHtml = "";

                if (allData[dateKey] && allData[dateKey].length > 0) {
                    allData[dateKey].forEach(drink => {
                        const price = parseInt(drink.price) || 0;
                        dailyTotal += price;
                        drinksHtml += `
                            <div class="drink-dot">
                                ${drink.store} <span style="font-size:0.7em">(${drink.sugar})</span>
                            </div>`;
                    });
                }

                const priceDisplay = dailyTotal > 0 ? `<span class="daily-cost">$${dailyTotal}</span>` : "";

                cell.innerHTML = `
                    <div class="day-number">
                        ${day}
                        ${priceDisplay}
                    </div>
                    ${drinksHtml}
                `;
                
                cell.onclick = () => openModal(dateKey);
                grid.appendChild(cell);
            }
        }

        function changeMonth(delta) {
            currentMonth += delta;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        }

        // --- Modal æ“ä½œ ---
        function openModal(dateKey) {
            selectedDateKey = dateKey;
            const modal = document.getElementById('drinkModal');
            document.getElementById('modalDateTitle').innerText = `${dateKey} ç´€éŒ„`;
            
            // é‡ç½®è¡¨å–®
            document.getElementById('storeName').value = "";
            document.getElementById('itemName').value = "";
            document.getElementById('drinkPrice').value = "";
            document.querySelectorAll('input[name="ice"]')[0].checked = true;
            document.querySelectorAll('input[name="sugar"]')[0].checked = true;

            renderModalList();
            modal.style.display = "flex";
        }

        function closeModal() {
            document.getElementById('drinkModal').style.display = "none";
        }

        window.onclick = function(event) {
            const modal = document.getElementById('drinkModal');
            if (event.target == modal) {
                closeModal();
            }
        }

        function renderModalList() {
            const listContainer = document.getElementById('savedDrinksList');
            const allData = getData();
            const todayDrinks = allData[selectedDateKey] || [];
            const saveBtn = document.getElementById('saveBtn');
            const limitMsg = document.getElementById('limitMsg');

            listContainer.innerHTML = "";

            if (todayDrinks.length === 0) {
                listContainer.innerHTML = "<p style='color:#999; text-align:center; padding:10px;'>æœ¬æ—¥å°šæœªå–é£²æ–™</p>";
            } else {
                todayDrinks.forEach((drink, index) => {
                    const item = document.createElement('div');
                    item.className = "saved-item";
                    const price = drink.price || 0;
                    item.innerHTML = `
                        <div class="saved-info">
                            <strong>${drink.store}</strong> ${drink.item}<br>
                            <small style="color:#666;">${drink.ice} / ${drink.sugar}</small>
                        </div>
                        <div style="display:flex; align-items:center;">
                            <span class="saved-price">$${price}</span>
                            <button class="del-btn" style="margin-left:10px;" onclick="deleteDrink(${index})">åˆªé™¤</button>
                        </div>
                    `;
                    listContainer.appendChild(item);
                });
            }

            // ä¸Šé™åˆ¤æ–·
            if (todayDrinks.length >= 2) {
                saveBtn.disabled = true;
                saveBtn.innerText = "å·²é”ä¸Šé™ (2æ¯)";
                limitMsg.style.display = "block";
            } else {
                saveBtn.disabled = false;
                saveBtn.innerText = "æ–°å¢é£²æ–™";
                limitMsg.style.display = "none";
            }
        }

        function saveDrink() {
            const store = document.getElementById('storeName').value.trim();
            const item = document.getElementById('itemName').value.trim();
            const price = document.getElementById('drinkPrice').value;
            const ice = document.querySelector('input[name="ice"]:checked').value;
            const sugar = document.querySelector('input[name="sugar"]:checked').value;

            if (!store || !item) { alert("è«‹å¡«å¯«åº—åèˆ‡å“é …ï¼"); return; }
            if (price === "") { alert("è«‹å¡«å¯«åƒ¹æ ¼ï¼"); return; }

            const allData = getData();
            if (!allData[selectedDateKey]) { allData[selectedDateKey] = []; }

            if (allData[selectedDateKey].length >= 2) {
                alert("ä¸€å¤©åªèƒ½å–å…©æ¯å–”ï¼");
                return;
            }

            allData[selectedDateKey].push({
                store, item, ice, sugar,
                price: parseInt(price)
            });

            saveData(allData);
            renderModalList(); 
        }

        function deleteDrink(index) {
            if(!confirm("ç¢ºå®šè¦åˆªé™¤é€™æ¯ç´€éŒ„å—ï¼Ÿ")) return;
            const allData = getData();
            if (allData[selectedDateKey]) {
                allData[selectedDateKey].splice(index, 1);
                saveData(allData);
                renderModalList();
            }
        }

        // --- å‚™ä»½/é‚„åŸ ---
        function exportData() {
            const data = localStorage.getItem(storageKey);
            if (!data || data === "{}") { alert("ç›®å‰æ²’æœ‰è³‡æ–™å¯ä»¥å‚™ä»½å–”ï¼"); return; }
            const blob = new Blob([data], {type: "application/json"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const dateStr = new Date().toISOString().split('T')[0];
            a.download = `BubbleTea_Backup_${dateStr}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function importData(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    JSON.parse(e.target.result); // æ¸¬è©¦æ ¼å¼
                    if(confirm("ç¢ºå®šè¦åŒ¯å…¥å‚™ä»½å—ï¼Ÿç›®å‰çš„ç´€éŒ„å°‡æœƒè¢«è¦†è“‹ï¼")) {
                        localStorage.setItem(storageKey, e.target.result);
                        renderCalendar();
                        alert("è³‡æ–™é‚„åŸæˆåŠŸï¼");
                    }
                } catch(err) { alert("æª”æ¡ˆæ ¼å¼éŒ¯èª¤ (.json)"); }
                input.value = ''; 
            };
            reader.readAsText(file);
        }

        init();
    </script>
</body>
</html>

